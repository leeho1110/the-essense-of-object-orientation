# 객체지향의 사실과 오해 PART 6 : 객체 지도

### 기능 설계 대 구조 설계

훌륭한 구조는 훌륭한 소프트웨어를 만들기 위한 필요조건이다. 미래에 대비하는 가장 좋은 방법은 변경을 예측하는 것이 아니라 변경을 수용할 수 있는 선택의 여지를 설계에 마련해 놓는 것이다. 

가장 좋은 방법은 자주 변경되는 기능이 아닌 안정적인 구조를 중심으로 설계하는 것이다. 

---

### 두 가지 재료: 기능과 구조

객체지향 세계 구축을 위해서는 사용자에게 제공할 **‘기능’**과 기능을 담을 **‘구조’**가 필요하다.

일반적으로 기능을 수집하고 표현한 것을 ‘유스케이스’, 구조를 수집하고 표현한 것을 ‘도메인 모델’ 이라고 한다.

---

### 안정적인 재료: 구조

병원에서는 모든 환자의 진료 기록을 보관하기 위해 SW를 사용하고, 분석하기 위해. 은행에서는 소중한 자산을 보호하기 위해 사용한다. 이 때 우리는 사용자가 프로그램을 사용하는 대상 분야를 **도메인**이라고 한다. 

도메인 모델은 사용자가 프로그램을 사용하는 대상 **영역에 관한 지식을 선택적으로 단순화하고 의식적으로 구조화한 형태**다. 즉, 대상을 추상화하고 단순화한 것이다. 은행 업무에서는 은행 도메인을 고객과 계좌 사이의 돈의 흐름으로, 자동차 판매업무에서는 구매 고객과 판매되는 자동차 사이의 거래 흐름을 도메인 모델이라고 생각할 것이다.

그렇다면 사용자 관점에서 이 도메인 모델은 어떨까. 우리의 관점과 다를 수도 있다. 이 때 사용자가 예측하는 모델을 우린 **사용자의 멘탈 모델**이라고 한다. 그런데 만약 우리가 생각하는 모델과 사용자의 모델이 다르다면 이 모델이 제대로 설계된 것일까? 

돈을 넣고 자판기에서 음료수가 나오지 않는다면 과연 제대로 된 설계일까? 즉, 우린 궁극적으로는 도메인 모델과 멘탈 모델의 불일치성을 최대한 낮추도록 설계해야 한다. 

---

### 불안정한 재료: 기능

기능적 요구사항은 시스템이 사용자에게 제공해야하는 기능의 목록을 정리한 것이다. 사용자들은 특정한 목표를 달성하기 위해 시스템과의 상호작용을 시작하고 이 흐름을 정리한 것을 우리는 **유스케이스**라고 한다.

> *사용자 목표가 유스케이스의 핵심이다. 유스케이스는 공통의 사용자 목표를 통해 강하게 연관된 시나리오의 집합이다 
-Martin Fowler*
> 

아래는 유스케이스의 중요한 특성이다. 

1. **유스케이스는 사용자와 시스템 간의 상호작용을 보여주는 텍스트다**
    
    다이어그램이 아니다. 사용자와 시스템 간의 삭호작용을 일련의 이야기 흐름으로 표현하는 것일 뿐이다.
    
2. **유스케이스는 하나의 시나리오가 아닌 여러 시나리오의 집합이다**
    
    이자 계산 유스케이스를 예로 들자면 이는 2개의 시나리오를 포함한다. 예금주가 계좌를 선택하고 당일까지의 이자액을 계산하는 것 하나, 예금주가 계좌를 선택하고 특정 일자까지의 이자액을 계산하는 것 둘. 그리고 우리는 이 시나리오를 **유스케이스 인스턴스**라고도 한다.
    

> 도메인 모델은 안정적인 구조의 개념화, 유스케이스는 불안정한 기능의 서술을 위해 사용된다. 우리가 변경에 유연한 소프트웨어를 만들기 위해서는 유스케이스에 정리된 시스템의 기능을 도메인 모델을 기반으로 한 객체들의 책임으로 분배해야 한다.
> 

객체의 이름은 도메인 모델에 포함된 개념으로부터 차용하고, 책임은 도메인 모델에 정의한 개념의 정의에 부합하도록 할당한다.

정기예금 이자 계산 예시에서는 **이자**를 계산하는 책임을 가진 객체는 **이자율**이 되고, **이자**는 **이자율**에 의해 생성될 것이다. 이 때 이자를 계산하는 책임이 이자율 객체에 할당되는 이유는 책임 할당의 기본 원칙이 책임을 수행하는데 필요한 정보를 가진 객체에게 그 책임을 할당하기 때문이다.

안정적인 도메인 모델을 기반으로 시스템의 기능을 구현할 경우 시스템의 기능이 변경되더라도 비즈니스의 핵심 정책이나 규칙이 변경되지 않는 한 전체적인 구조가 한 번에 흔들리지는 않는다. 객체지향의 큰 장점은 도메인을 모델링하는 기법과 도메인을 프로그래밍하기 위해 사용하는 기법이 동일하다는 것이다. 즉, 도메인 모델링에서 사용한 객체와 개념을 프로그래밍 설계에서의 객체와 클래스로 매끄럽게 변환할 수 있다는 것이다. 우리는 이 같은 특성을 **연결완전성**이라고 한다.

---

### 재료 합치기: 기능과 구조의 통합

객체지향 패러다임은 모든 것이 객체라는 사상에서 출발한다. 즉 유스케이스에 명시된 기능을 구현하는 시스템도  사용자의 목표를 만족시키기 위해 사용자와의 협력에 참여하는 커다란 객체다. 이 객체 안에는 더 작은 규모의 객체가 포함될 수 있다. 결국은 시스템이 수행해야 하는 거대한 책임이 더 작은 크기의 객체들의 협력을 통해 세분화되어 구현되는 것이다.

> 객체 설계는 가끔 다음과 같이 표현되기도 한다. 요구사항들을 식별하고 도메인 모델을 생성한 후 , 소프트웨어 클래스에 메서드들을 추가하고, 요구사항을 충족시키기 위해 객체들 간의 메시지 전송을 정의하라.
> 

유스케이스는 사용자에게 제공하는 기능을 시스템의 책임으로 변환한다. 도메인 모델은 기능을 수용하기 위한 안정적인 구조를 제공한다. 우린 여기서 앞서 얘기했던 책임-주도 설계를 상기시켜야한다. 책임-주도 설계는 유스케이스로부터 첫번째 메시지와 사용자가 달성하려는 목표를, 도메인 모델로부터 기능을 수용할 수 있는 안정적인 구조를 제공받아 실제로 동작하는 객체들의 협력 공동체를 창조한다. 

여기서 핵심은 견고한 객체지향 애플리케이션을 개발하기 위해서는 사용자의 관점에서 시스템의 기능을 명시하여 기능을 책임으로 변환하는 절차를 따라야 한다는 것이다.
